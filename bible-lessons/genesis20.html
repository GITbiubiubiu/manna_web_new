<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Genesis 20: Abraham and Abimelech - Manna</title>
<meta name="description" content="Bible Lessons on Genesis 20 KJV: genesis 20 explained verse by verse.">
<link rel="stylesheet" href="../styles.css">
<link rel="stylesheet" href="../css/lesson-content.css">
<link rel="icon" href="../public/images/icon.png">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DF5ZGFNKTB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DF5ZGFNKTB');
</script>
</head>

<body>
<!-- Header -->
<header>
  <div class="container">
    <div class="header-content">
      <div class="logo">
        <a href="/">
          <img src="../public/images/icon.png" alt="Manna Icon">
          <span>Manna</span>
        </a>
      </div>
      <nav>
        <ul>
          <li><a href="/bible-lessons">Lessons</a></li>
          <li><a href="/prayers">Prayers</a></li>
          <li><a href="/resources">Resources</a></li>
          <li><a href="/download">Download</a></li>
        </ul>
      </nav>
      <div class="social-header">
        <a href="https://discord.gg/NbQVtWeNMa"><img src="../public/images/discard.png" alt="Discord"></a>
        <a href="https://www.instagram.com/the_manna_app"><img src="../public/images/ins.png" alt="Instagram"></a>
        <a href="https://www.tiktok.com/@manna.app"><img src="../public/images/tt.png" alt="TikTok"></a>
      </div>
    </div>
  </div>
</header>

<!-- Lesson Content -->
<section class="lesson-content-section">
  <div class="container lesson-container">
    <!-- Left Side: Lesson Content -->
    <div class="lesson-content">
      <div class="lesson-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 0%"></div>
        </div>
        <div class="progress-text">0% Complete</div>
      </div>

      <!-- Section 1 -->
      <div class="lesson-section" id="section1">
        <div class="lesson-card">
          <div class="lesson-card-header">
            <h2>Abraham and Abimelech in Gerar</h2>
            <div class="lesson-reference" data-verses="1-7">Genesis 20:1-7</div>
          </div>
          <div class="lesson-card-body">
            <div class="key-verse">
              <blockquote>
                "And God said unto him in a dream, Yea, I know that thou didst this in the integrity of thy heart; for I also withheld thee from sinning against me: therefore suffered I thee not to touch her."
                <cite>Genesis 20:6</cite>
              </blockquote>
            </div>
            <div class="key-points">
              <h3>Key Points:</h3>
              <ul>
                <li>Abraham lies about Sarah being his sister to King Abimelech</li>
                <li>God warns Abimelech in a dream about Sarah's true identity</li>
                <li>Abimelech is innocent but must return Sarah to avoid punishment</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="lesson-detail">
          <p>Abraham moves to Gerar and tells King Abimelech that Sarah is his sister, hiding their marriage. Fearful for his life, Abraham believes the people there might kill him to take his wife. However, God intervenes by appearing to Abimelech in a dream, warning him that Sarah is actually married. Abimelech, unaware of the truth, protests his innocence, and God acknowledges this but instructs him to return Sarah to avoid consequences. This shows how God protects His promises, even when human actions are flawed.</p>
        </div>
        <div class="lesson-navigation-buttons">
          <button class="next-section-btn" data-next="section2">Continue</button>
        </div>
      </div>

      <!-- Section 2 -->
      <div class="lesson-section hidden" id="section2">
        <div class="lesson-card">
          <div class="lesson-card-header">
            <h2>Abimelech Confronts Abraham</h2>
            <div class="lesson-reference" data-verses="8-13">Genesis 20:8-13</div>
          </div>
          <div class="lesson-card-body">
            <div class="key-verse">
              <blockquote>
                "And Abraham said, Because I thought, Surely the fear of God is not in this place; and they will slay me for my wife's sake."
                <cite>Genesis 20:11</cite>
              </blockquote>
            </div>
            <div class="key-points">
              <h3>Key Points:</h3>
              <ul>
                <li>Abimelech questions Abraham about his deception</li>
                <li>Abraham explains his fear of being killed for his wife</li>
                <li>Abraham admits to a half-truth, as Sarah is his half-sister</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="lesson-detail">
          <p>Abimelech confronts Abraham after realizing the deception. He demands an explanation, shocked that such a lie could bring guilt upon his kingdom. Abraham admits his fear drove him to mislead others, revealing that Sarah is both his wife and half-sister. While his reasoning comes from past experiences, it highlights a lack of trust in God's protection. Abimelech's response is surprisingly gracious, showing wisdom in handling the situation despite Abraham's mistake.</p>
        </div>
        <div class="lesson-navigation-buttons">
          <button class="prev-section-btn" data-prev="section1">Previous</button>
          <button class="next-section-btn" data-next="section3">Continue</button>
        </div>
      </div>

      <!-- Section 3 -->
      <div class="lesson-section hidden" id="section3">
        <div class="lesson-card">
          <div class="lesson-card-header">
            <h2>Restoration and Blessing</h2>
            <div class="lesson-reference" data-verses="14-18">Genesis 20:14-18</div>
          </div>
          <div class="lesson-card-body">
            <div class="key-verse">
              <blockquote>
                "So Abraham prayed unto God: and God healed Abimelech, and his wife, and his maidservants; and they bare children."
                <cite>Genesis 20:17</cite>
              </blockquote>
            </div>
            <div class="key-points">
              <h3>Key Points:</h3>
              <ul>
                <li>Abimelech returns Sarah and gives gifts to Abraham</li>
                <li>Abraham prays for Abimelech, and God heals his household</li>
                <li>God's protection over Sarah is reaffirmed</li>
              </ul>
            </div>
          </div>
        </div>
        <div class="lesson-detail">
          <p>To make amends, Abimelech returns Sarah to Abraham and gives them livestock, servants, and land as a gesture of goodwill. He also allows them to live freely in his kingdom. Abraham then prays for Abimelech, and God heals the king's household, which had been struck with infertility due to the incident. This resolution demonstrates God's mercy and how He works through imperfect people to restore relationships and fulfill His plans.</p>
        </div>
        <div class="lesson-navigation-buttons">
          <button class="prev-section-btn" data-prev="section2">Previous</button>
          <button class="next-section-btn" data-next="quiz">Test My Mastery</button>
        </div>
      </div>

      <!-- Quiz Section -->
      <div class="lesson-section hidden" id="quiz">
        <div class="lesson-card quiz-card">
          <div class="lesson-card-header">
            <h2>Level Up Test</h2>
            <div class="lesson-reference" data-verses="1-18">Genesis 20</div>
          </div>
          <div class="lesson-card-body">
            <div class="quiz-container">
              <div class="quiz-progress">
                <span id="quiz-progress-text">Question 1 of 3</span>
                <div class="quiz-progress-bar">
                  <div class="quiz-progress-fill" style="width: 33%"></div>
                </div>
              </div>
              
              <form id="quiz-form">
                <!-- Question 1 -->
                <div class="quiz-question" id="question1">
                  <h3>1. Why did Abraham lie about Sarah being his sister?</h3>
                  <div class="quiz-options">
                    <div class="quiz-option">
                      <input type="radio" id="q1a" name="q1" value="A">
                      <label for="q1a">A. He wanted to test Abimelech's honesty</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q1b" name="q1" value="B">
                      <label for="q1b">B. He feared being killed for his wife</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q1c" name="q1" value="C">
                      <label for="q1c">C. He didn't consider her his true wife</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q1d" name="q1" value="D">
                      <label for="q1d">D. He planned to leave her in Gerar</label>
                    </div>
                  </div>
                  <div class="quiz-hint hidden">
                    <p><strong>Hint:</strong> Genesis 20:11</p>
                  </div>
                  <div class="quiz-feedback hidden"></div>
                  <div class="quiz-controls">
                    <div class="quiz-buttons-center">
                      <button type="button" class="submit-question-btn" data-question="1" data-verses="11">Submit Answer</button>
                    </div>
                  </div>
                </div>

                <!-- Question 2 -->
                <div class="quiz-question hidden" id="question2">
                  <h3>2. How did God communicate with Abimelech about Sarah?</h3>
                  <div class="quiz-options">
                    <div class="quiz-option">
                      <input type="radio" id="q2a" name="q2" value="A">
                      <label for="q2a">A. Through a prophet</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q2b" name="q2" value="B">
                      <label for="q2b">B. In a dream</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q2c" name="q2" value="C">
                      <label for="q2c">C. By sending an angel</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q2d" name="q2" value="D">
                      <label for="q2d">D. With a loud voice from heaven</label>
                    </div>
                  </div>
                  <div class="quiz-hint hidden">
                    <p><strong>Hint:</strong> Genesis 20:3</p>
                  </div>
                  <div class="quiz-feedback hidden"></div>
                  <div class="quiz-controls">
                    <div class="quiz-buttons-center">
                      <button type="button" class="prev-question-btn" data-prev="1">Previous</button>
                      <button type="button" class="submit-question-btn" data-question="2" data-verses="3">Submit Answer</button>
                    </div>
                  </div>
                </div>

                <!-- Question 3 -->
                <div class="quiz-question hidden" id="question3">
                  <h3>3. What did Abimelech do after discovering the truth?</h3>
                  <div class="quiz-options">
                    <div class="quiz-option">
                      <input type="radio" id="q3a" name="q3" value="A">
                      <label for="q3a">A. Banished Abraham from Gerar</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q3b" name="q3" value="B">
                      <label for="q3b">B. Gave gifts and returned Sarah</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q3c" name="q3" value="C">
                      <label for="q3c">C. Arrested Abraham for lying</label>
                    </div>
                    <div class="quiz-option">
                      <input type="radio" id="q3d" name="q3" value="D">
                      <label for="q3d">D. Ignored the situation</label>
                    </div>
                  </div>
                  <div class="quiz-hint hidden">
                    <p><strong>Hint:</strong> Genesis 20:14-16</p>
                  </div>
                  <div class="quiz-feedback hidden"></div>
                  <div class="quiz-controls">
                    <div class="quiz-buttons-center">
                      <button type="button" class="prev-question-btn" data-prev="2">Previous</button>
                      <button type="button" class="submit-question-btn" data-question="3" data-verses="14-16">Submit Answer</button>
                    </div>
                  </div>
                </div>
              </form>

              <div id="quiz-results" class="hidden">
                <h3>Your Results</h3>
                <p id="quiz-score"></p>
                <div id="quiz-feedback"></div>
                <div class="quiz-result-buttons">
                  <button id="retry-quiz-btn">Try Again</button>
                  <button id="complete-lesson-btn">Complete Lesson</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="lesson-navigation-buttons">
          <button class="prev-section-btn" data-prev="section3">Previous</button>
        </div>
      </div>

      <!-- Completion Message (Hidden initially) -->
      <div class="lesson-completion hidden" id="completion">
        <div class="completion-card">
          <div class="completion-header">
            <div class="completion-icon">âœ“</div>
            <h2>Lesson Complete!</h2>
          </div>
          <div class="completion-content">
            <p class="completion-message">Congratulations on completing Genesis 20. You've learned about Abraham's encounter with Abimelech and God's protection over His promises.</p>
            
            <div class="app-promotion">
              <p class="app-promotion-text">Download the Manna App to unlock more free content.</p>
              <ul class="app-features-list">
                <li>More audio courses, Prayer, and Devotional content for Free</li>
                <li>Progress tracking, streak rewards, and grow closer to God</li>
                <li>Get answers to any Bible-related questions</li>
              </ul>
              <div class="download-options">
                <div class="qr-code">
                  <img src="../public/images/qrcode.png" alt="QR Code to download Manna App">
                </div>
                <div class="app-store-links">
                  <a href="https://apps.apple.com/us/app/manna-bible-study-prayer/id1669523799" class="app-store-link">
                    <img src="../public/images/download.png" alt="Download on App Store">
                  </a>
                </div>
              </div>
            </div>
            
            <div class="completion-buttons">
              <a href="/bible-lessons/genesis21" class="lesson-btn primary-btn">Next Lesson: Genesis 21</a>
              <a href="/bible-lessons" class="lesson-btn secondary-btn">Back to Lessons</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Side: Bible Text -->
    <div class="bible-text">
      <div class="bible-header">
        <h2>Genesis 20</h2>
        <div class="bible-controls">
          <button id="increase-font">A+</button>
          <button id="decrease-font">A-</button>
        </div>
      </div>
      <div class="bible-content">
        <p><sup>1</sup> And Abraham journeyed from thence toward the south country, and dwelled between Kadesh and Shur, and sojourned in Gerar.</p>
        <p><sup>2</sup> And Abraham said of Sarah his wife, She is my sister: and Abimelech king of Gerar sent, and took Sarah.</p>
        <p><sup>3</sup> But God came to Abimelech in a dream by night, and said to him, Behold, thou art but a dead man, for the woman which thou hast taken; for she is a man's wife.</p>
        <p><sup>4</sup> But Abimelech had not come near her: and he said, Lord, wilt thou slay also a righteous nation?</p>
        <p><sup>5</sup> Said he not unto me, She is my sister? and she, even she herself said, He is my brother: in the integrity of my heart and innocency of my hands have I done this.</p>
        <p><sup>6</sup> And God said unto him in a dream, Yea, I know that thou didst this in the integrity of thy heart; for I also withheld thee from sinning against me: therefore suffered I thee not to touch her.</p>
        <p><sup>7</sup> Now therefore restore the man his wife; for he is a prophet, and he shall pray for thee, and thou shalt live: and if thou restore her not, know thou that thou shalt surely die, thou, and all that are thine.</p>
        <p><sup>8</sup> Therefore Abimelech rose early in the morning, and called all his servants, and told all these things in their ears: and the men were sore afraid.</p>
        <p><sup>9</sup> Then Abimelech called Abraham, and said unto him, What hast thou done unto us? and what have I offended thee, that thou hast brought on me and on my kingdom a great sin? thou hast done deeds unto me that ought not to be done.</p>
        <p><sup>10</sup> And Abimelech said unto Abraham, What sawest thou, that thou hast done this thing?</p>
        <p><sup>11</sup> And Abraham said, Because I thought, Surely the fear of God is not in this place; and they will slay me for my wife's sake.</p>
        <p><sup>12</sup> And yet indeed she is my sister; she is the daughter of my father, but not the daughter of my mother; and she became my wife.</p>
        <p><sup>13</sup> And it came to pass, when God caused me to wander from my father's house, that I said unto her, This is thy kindness which thou shalt shew unto me; at every place whither we shall come, say of me, He is my brother.</p>
        <p><sup>14</sup> And Abimelech took sheep, and oxen, and menservants, and womenservants, and gave them unto Abraham, and restored him Sarah his wife.</p>
        <p><sup>15</sup> And Abimelech said, Behold, my land is before thee: dwell where it pleaseth thee.</p>
        <p><sup>16</sup> And unto Sarah he said, Behold, I have given thy brother a thousand pieces of silver: behold, he is to thee a covering of the eyes, unto all that are with thee, and with all other: thus she was reproved.</p>
        <p><sup>17</sup> So Abraham prayed unto God: and God healed Abimelech, and his wife, and his maidservants; and they bare children.</p>
        <p><sup>18</sup> For the Lord had fast closed up all the wombs of the house of Abimelech, because of Sarah Abraham's wife.</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer>
  <div class="container">
    <div class="footer-content">
      <div class="footer-column">
        <h4>Links</h4>
        <div class="social-links">
          <a href="https://discord.gg/NbQVtWeNMa"><img src="../public/images/discard.png" alt="Discord"></a>
          <a href="https://www.instagram.com/the_manna_app"><img src="../public/images/ins.png" alt="Instagram"></a>
          <a href="https://www.tiktok.com/@manna.app"><img src="../public/images/tt.png" alt="TikTok"></a>
        </div>
      </div>
      <div class="footer-column">
        <h4>Contact Us</h4>
        <p><a href="mailto:support@themanna.app">support@themanna.app</a></p>
      </div>
      <div class="footer-column">
        <h4>Legal</h4>
        <div class="legal">
          <a href="https://s.femometer.com/html_template/3027.html">Privacy Policy</a>
          <a href="https://s.femometer.com/html_template/3028.html">Terms of Service</a>
        </div>
      </div>
    </div>
    <div class="copyright">
      <p>&copy; 2025 Baymed Limited. All rights reserved.</p>
    </div>
  </div>
</footer>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Navigation between sections
    const sections = document.querySelectorAll('.lesson-section');
    const progressBar = document.querySelector('.progress-fill');
    const progressText = document.querySelector('.progress-text');
    const bibleVerses = document.querySelectorAll('.bible-content p');
    let currentSectionIndex = 0;
    const totalSections = sections.length - 1; // Excluding quiz section
    
    // Highlight and scroll to the specified scripture
    function highlightVerses(verseRange) {
      // Remove previous highlighting
      bibleVerses.forEach(verse => {
        verse.classList.remove('highlighted');
      });
      
      if (verseRange) {
        const [start, end] = verseRange.split('-').map(v => parseInt(v));
        const endVerse = end || start;
        
        // Add highlighting to the referenced scripture
        for (let i = start - 1; i < endVerse; i++) {
          if (bibleVerses[i]) {
            bibleVerses[i].classList.add('highlighted');
            
            // Scroll to the first highlighted scripture
            if (i === start - 1) {
              bibleVerses[i].scrollIntoView({
                behavior: 'smooth',
                block: 'center'
              });
            }
          }
        }
      }
    }
    
    // Update progress
    function updateProgress() {
      if (currentSectionIndex < totalSections) {
        const progress = Math.round((currentSectionIndex / totalSections) * 100);
        progressBar.style.width = `${progress}%`;
        progressText.textContent = `${progress}% Complete`;
      }
    }
    
    // Show section
    function showSection(sectionId) {
      sections.forEach(section => {
        section.classList.add('hidden');
      });
      
      const currentSection = document.getElementById(sectionId);
      currentSection.classList.remove('hidden');
      
      // Update current section index
      for (let i = 0; i < sections.length; i++) {
        if (sections[i].id === sectionId) {
          currentSectionIndex = i;
          break;
        }
      }
      
      // Auto highlight relevant verses
      const reference = currentSection.querySelector('.lesson-reference');
      if (reference) {
        const verseRange = reference.getAttribute('data-verses');
        highlightVerses(verseRange);
      }
      
      updateProgress();

      // If quiz section, hide Previous buttons
      if (sectionId === 'quiz') {
        document.querySelector('#quiz .lesson-navigation-buttons .prev-section-btn').style.display = 'none';
        document.querySelectorAll('.prev-question-btn').forEach(button => {
          button.style.display = 'none';
        });
      }
      
      // Scroll to section top
      window.scrollTo({
        top: document.querySelector('.lesson-content').offsetTop - 100,
        behavior: 'smooth'
      });
    }
    
    // Next section buttons
    document.querySelectorAll('.next-section-btn').forEach(button => {
      button.addEventListener('click', function() {
        const nextSectionId = this.getAttribute('data-next');
        showSection(nextSectionId);
      });
    });
    
    // Previous section buttons
    document.querySelectorAll('.prev-section-btn').forEach(button => {
      button.addEventListener('click', function() {
        const prevSectionId = this.getAttribute('data-prev');
        showSection(prevSectionId);
      });
    });
    
    // Initialize scripture highlighting for the first section
    const initialReference = document.querySelector('#section1 .lesson-reference');
    if (initialReference) {
      const verseRange = initialReference.getAttribute('data-verses');
      highlightVerses(verseRange);
    }
    
    // Quiz functionality
    const quizForm = document.getElementById('quiz-form');
    const quizQuestions = document.querySelectorAll('.quiz-question');
    const quizResults = document.getElementById('quiz-results');
    const quizScore = document.getElementById('quiz-score');
    const quizFeedback = document.getElementById('quiz-feedback');
    const retryQuizBtn = document.getElementById('retry-quiz-btn');
    const completeLessonBtn = document.getElementById('complete-lesson-btn');
    const quizProgressText = document.getElementById('quiz-progress-text');
    const quizProgressFill = document.querySelector('.quiz-progress-fill');
    const bibleTextSection = document.querySelector('.bible-text');
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let questionSubmitted = {};

    // Hide Bible text on initialization
    function toggleBibleText(show) {
      if (show) {
        bibleTextSection.style.display = 'block';
      } else {
        bibleTextSection.style.display = 'none';
      }
    }

    // Show specified question
    function showQuestion(index) {
      quizQuestions.forEach((question, i) => {
        if (i === index) {
          question.classList.remove('hidden');
        } else {
          question.classList.add('hidden');
        }
      });
      
      // Update progress bar
      currentQuestionIndex = index;
      quizProgressText.textContent = `Question ${index + 1} of ${quizQuestions.length}`;
      quizProgressFill.style.width = `${((index + 1) / quizQuestions.length) * 100}%`;
      
      // Show Bible text if question submitted, otherwise hide
      toggleBibleText(questionSubmitted[index + 1]);
    }

    // Submit question answer
    function submitQuestion(questionNumber, verseRange) {
      const questionIndex = questionNumber - 1;
      const selectedOption = document.querySelector(`input[name="q${questionNumber}"]:checked`);
      const feedbackElement = document.querySelector(`#question${questionNumber} .quiz-feedback`);
      const hintElement = document.querySelector(`#question${questionNumber} .quiz-hint`);
      const submitButton = document.querySelector(`#question${questionNumber} .submit-question-btn`);
      const nextButton = document.createElement('button');
      nextButton.type = 'button';
      nextButton.className = 'next-question-btn';
      
      const answers = {
        q1: 'B',
        q2: 'B',
        q3: 'B'
      };
      
      if (!selectedOption) {
        feedbackElement.innerHTML = '<p class="incorrect">Please select an answer.</p>';
        feedbackElement.classList.remove('hidden');
        return;
      }
      
      // Record user answer
      userAnswers[`q${questionNumber}`] = selectedOption.value;
      questionSubmitted[questionNumber] = true;
      
      // Show hint
      hintElement.classList.remove('hidden');
      
      // Disable options and submit button
      document.querySelectorAll(`#question${questionNumber} input[type="radio"]`).forEach(input => {
        input.disabled = true;
      });
      submitButton.disabled = true;
      submitButton.style.display = 'none'; 
      
      // Show feedback
      if (selectedOption.value === answers[`q${questionNumber}`]) {
        feedbackElement.innerHTML = '<p class="correct">Correct!</p>';
      } else {
        feedbackElement.innerHTML = `<p class="incorrect">Incorrect. The correct answer is ${answers[`q${questionNumber}`]}.</p>`;
      }
      feedbackElement.classList.remove('hidden');
      
      // Show Bible text and highlight verses
      toggleBibleText(true);
      highlightVerses(verseRange);
      
      // Add next button
      if (questionNumber < quizQuestions.length) {
        nextButton.textContent = 'Next Question';
        nextButton.setAttribute('data-next', questionNumber + 1);
        nextButton.addEventListener('click', function() {
          showQuestion(parseInt(this.getAttribute('data-next')) - 1);
        });
        submitButton.parentNode.appendChild(nextButton);
      } else {
        // If last question, add view results button
        nextButton.textContent = 'View Results';
        nextButton.addEventListener('click', showResults);
        submitButton.parentNode.appendChild(nextButton);
      }
    }

    // Show quiz results
    function showResults() {
      const answers = {
        q1: 'B',
        q2: 'B',
        q3: 'B'
      };
      
      let score = 0;
      let feedback = '';
      
      // Check answers
      for (const question in answers) {
        if (userAnswers[question] === answers[question]) {
          score++;
          feedback += `<p class="correct">Question ${question.substring(1)}: Correct!</p>`;
        } else {
          feedback += `<p class="incorrect">Question ${question.substring(1)}: Incorrect. The correct answer is ${answers[question]}.</p>`;
        }
      }
      
      // Show results
      quizScore.textContent = `You scored ${score} out of 3`;
      quizFeedback.innerHTML = feedback;
      
      // Hide questions, show results
      quizQuestions.forEach(question => {
        question.classList.add('hidden');
      });
      quizResults.classList.remove('hidden');
    }

    // Reset quiz
    retryQuizBtn.addEventListener('click', function() {
      quizForm.reset();
      quizResults.classList.add('hidden');
      userAnswers = {};
      questionSubmitted = {};
      
      // Reset all question states
      document.querySelectorAll('.quiz-hint').forEach(element => {
        element.classList.add('hidden');
      });
      
      document.querySelectorAll('.quiz-feedback').forEach(element => {
        element.classList.add('hidden');
        element.innerHTML = ''; 
      });
      
      document.querySelectorAll('.quiz-question input[type="radio"]').forEach(input => {
        input.disabled = false;
      });
      
      document.querySelectorAll('.submit-question-btn').forEach(button => {
        button.disabled = false;
        button.style.display = '';
      });
      
      document.querySelectorAll('.next-question-btn').forEach(button => {
        button.remove();
      });
      
      // Show first question
      showQuestion(0);
      toggleBibleText(false);
    });

    // Complete lesson
    completeLessonBtn.addEventListener('click', function() {
      document.getElementById('quiz').classList.add('hidden');
      document.getElementById('completion').classList.remove('hidden');
      progressBar.style.width = '100%';
      progressText.textContent = '100% Complete';
      toggleBibleText(false);
    });

    // Previous question button
    document.querySelectorAll('.prev-question-btn').forEach(button => {
      button.addEventListener('click', function() {
        const prevQuestionIndex = parseInt(this.getAttribute('data-prev')) - 1;
        showQuestion(prevQuestionIndex);
      });
    });

    // Submit answer button
    document.querySelectorAll('.submit-question-btn').forEach(button => {
      button.addEventListener('click', function() {
        const questionNumber = parseInt(this.getAttribute('data-question'));
        const verseRange = this.getAttribute('data-verses');
        submitQuestion(questionNumber, verseRange);
      });
    });

    // Initialize quiz
    function initQuiz() {
      // Ensure only the first question is displayed, hide others
      quizQuestions.forEach((question, i) => {
        if (i === 0) {
          question.classList.remove('hidden');
        } else {
          question.classList.add('hidden');
        }
      });
      
      // Hide all hints
      document.querySelectorAll('.quiz-hint').forEach(hint => {
        hint.classList.add('hidden');
      });
      
      // Hide results section
      document.getElementById('quiz-results').classList.add('hidden');
      
      // Hide Previous button in bottom navigation
      document.querySelector('#quiz .lesson-navigation-buttons .prev-section-btn').style.display = 'none';
      
      // Hide Previous button in all questions
      document.querySelectorAll('.prev-question-btn').forEach(button => {
        button.style.display = 'none';
      });
      
      toggleBibleText(false);
    }

    // Initialize when entering quiz section
    document.querySelector('[data-next="quiz"]').addEventListener('click', function() {
      setTimeout(initQuiz, 100); 
    });
    
    // Bible text font size controls
    const bibleContent = document.querySelector('.bible-content');
    let fontSize = 16; // Default font size
    
    document.getElementById('increase-font').addEventListener('click', function() {
      if (fontSize < 24) {
        fontSize += 2;
        bibleContent.style.fontSize = `${fontSize}px`;
      }
    });
    
    document.getElementById('decrease-font').addEventListener('click', function() {
      if (fontSize > 12) {
        fontSize -= 2;
        bibleContent.style.fontSize = `${fontSize}px`;
      }
    });
  });
</script>
</body>
</html>
